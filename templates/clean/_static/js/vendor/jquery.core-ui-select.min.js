(function(d){var b={appendToBody:false,jScrollPane:null,onInit:null,onFocus:null,onBlur:null,onOpen:null,onClose:null,onChange:null,onDestroy:null};var a=[];d.browser.mobile=(/iphone|ipad|ipod|android/i.test(navigator.userAgent.toLowerCase()));d.browser.operamini=Object.prototype.toString.call(window.operamini)==="[object OperaMini]";function c(h,f,g){this.domSelect=h;this.settings=f||b;this.isSelectShow=false;this.isSelectFocus=false;this.isJScrollPane=this.isJScrollPane();this.templates=g||{select:{container:'<div class="b-core-ui-select"></div>',value:'<span class="b-core-ui-select__value"></span>',button:'<span class="b-core-ui-select__button"></span>'},dropdown:{container:'<div class="b-core-ui-select__dropdown"></div>',wrapper:'<div class="b-core-ui-select__dropdown__wrap"></div>',list:'<ul class="b-core-ui-select__dropdown__list"></ul>',optionLabel:'<li class="b-core-ui-select__dropdown__label"></li>',item:'<li class="b-core-ui-select__dropdown__item"></li>'}};this.init(this.settings)}c.prototype.init=function(){if(d.browser.operamini){return this}this.buildUI();this.hideDomSelect();if(this.domSelect.is(":disabled")){this.select.addClass("disabled");return this}if(this.isJScrollPane){this.buildJScrollPane()}this.bindUIEvents();this.settings.onInit&&this.settings.onInit.apply(this,[this.domSelect,"init"])};c.prototype.buildUI=function(){this.select=d(this.templates.select.container).insertBefore(this.domSelect);this.selectValue=d(this.templates.select.value).appendTo(this.select);this.selectButton=d(this.templates.select.button).appendTo(this.select);this.dropdown=d(this.templates.dropdown.container);this.dropdownWrapper=d(this.templates.dropdown.wrapper).appendTo(this.dropdown);this.settings.appendToBody?this.dropdown.appendTo(d("body")):this.dropdown.insertBefore(this.domSelect);this.dropdownList=d(this.templates.dropdown.list).appendTo(this.dropdownWrapper);this.domSelect.find("option").each(d.proxy(this,"addItems"));this.dropdownItem=this.dropdown.find("."+d(this.templates.dropdown.item).attr("class"));this.dropdownItem.filter(":first-child").addClass("first");this.dropdownItem.filter(":last-child").addClass("last");this.addOptionGroup();this.setSelectValue(this.getSelectedItem().text());this.updateDropdownPosition();this.currentItemOfDomSelect=this.currentItemOfDomSelect||this.domSelect.find("option:selected")};c.prototype.hideDomSelect=function(){this.domSelect.addClass("b-core-ui-select__select_state_hide");this.domSelect.css({top:this.select.position().top,left:this.select.position().left})};c.prototype.showDomSelect=function(){this.domSelect.css({top:"auto",left:"auto"});this.domSelect.removeClass("b-core-ui-select__select_state_hide")};c.prototype.bindUIEvents=function(){this.domSelect.bind("focus",d.proxy(this,"onFocus"));this.domSelect.bind("blur",d.proxy(this,"onBlur"));this.domSelect.bind("change",d.proxy(this,"onChange"));if(d.browser.mobile){this.domSelect.bind("change",d.proxy(this,"changeDropdownData"))}this.select.bind("click",d.proxy(this,"onSelectClick"));this.dropdownItem.bind("click",d.proxy(this,"onDropdownItemClick"))};c.prototype.getCurrentIndexOfItem=function(f){return this.domSelect.find("option").index(d(this.domSelect).find("option:selected"))};c.prototype.scrollToCurrentDropdownItem=function(f){if(this.dropdownWrapper.data("jsp")){this.dropdownWrapper.data("jsp").scrollToElement(f);return this}d(this.dropdownWrapper).scrollTop(d(this.dropdownWrapper).scrollTop()+f.position().top-d(this.dropdownWrapper).height()/2+f.height()/2)};c.prototype.buildJScrollPane=function(){this.dropdownWrapper.wrap(d('<div class="j-scroll-pane"></div>'))};c.prototype.isJScrollPane=function(){if(this.settings.jScrollPane){if(d.fn.jScrollPane){return true}else{throw new Error("jScrollPane no found")}}};c.prototype.initJScrollPane=function(){this.dropdownWrapper.jScrollPane(this.settings.jScrollPane)};c.prototype.showDropdown=function(){this.domSelect.focus();this.settings.onOpen&&this.settings.onOpen.apply(this,[this.domSelect,"open"]);if(d.browser.mobile){return this}if(!this.isSelectShow){this.isSelectShow=true;this.select.addClass("open");this.dropdown.addClass("show").removeClass("hide");if(this.isJScrollPane){this.initJScrollPane()}this.scrollToCurrentDropdownItem(this.dropdownItem.eq(this.getCurrentIndexOfItem()));this.updateDropdownPosition()}};c.prototype.hideDropdown=function(){if(this.isSelectShow){this.isSelectShow=false;this.select.removeClass("open");this.dropdown.removeClass("show").addClass("hide");this.settings.onClose&&this.settings.onClose.apply(this,[this.domSelect,"close"])}if(this.isSelectFocus){this.domSelect.focus()}};c.prototype.hideAllDropdown=function(){for(var f in a){if(a[f].hasOwnProperty(f)){a.dropdown.isSelectShow=false;a.dropdown.domSelect.blur();a.dropdown.addClass("hide").removeClass("show")}}};c.prototype.changeDropdownData=function(f){if((this.isSelectShow||this.isSelectFocus)){this.currentItemOfDomSelect=this.domSelect.find("option:selected");this.dropdownItem.removeClass("selected");this.dropdownItem.eq(this.getCurrentIndexOfItem()).addClass("selected");this.scrollToCurrentDropdownItem(this.dropdownItem.eq(this.getCurrentIndexOfItem()));this.setSelectValue(this.currentItemOfDomSelect.text())}if(d.browser.mobile){this.settings.onChange&&this.settings.onChange.apply(this,[this.domSelect,"change"])}};c.prototype.onDomSelectChange=function(f){this.domSelect.bind("change",d.proxy(this,"onChange"));e(this.domSelect.get(0),"change");if(!f){this.settings.onChange&&this.settings.onChange.apply(this,[this.domSelect,"change"])}};c.prototype.addListenerByServicesKey=function(f){if(this.isSelectShow){switch(f.which){case 9:case 13:case 27:this.hideDropdown();break}}};c.prototype.onSelectClick=function(){if(!this.isSelectShow){this.showDropdown()}else{this.hideDropdown()}return false};c.prototype.onFocus=function(){this.isDocumentMouseDown=false;this.isSelectFocus=true;this.select.addClass("focus");this.settings.onFocus&&this.settings.onFocus.apply(this,[this.domSelect,"focus"])};c.prototype.onBlur=function(){if(!this.isDocumentMouseDown){this.isSelectFocus=false;this.select.removeClass("focus");this.settings.onBlur&&this.settings.onBlur.apply(this,[this.domSelect,"blur"])}};c.prototype.onChange=function(){this.settings.onChange&&this.settings.onChange.apply(this,[this.domSelect,"change"])};c.prototype.onDropdownItemClick=function(h){var g=d(h.currentTarget);if(!(g.hasClass("disabled")||g.hasClass("selected"))){this.domSelect.unbind("change",d.proxy(this,"onChange"));var f=this.dropdown.find("."+d(this.templates.dropdown.item).attr("class")).index(g);this.dropdownItem.removeClass("selected");this.dropdownItem.eq(f).addClass("selected");this.domSelect.find("option").removeAttr("selected");this.domSelect.find("option").eq(f).attr("selected",true);this.setSelectValue(this.getSelectedItem().text());this.onDomSelectChange(true)}this.hideDropdown();return false};c.prototype.onDocumentMouseDown=function(f){this.isDocumentMouseDown=true;if(d(f.target).closest(this.select).length==0&&d(f.target).closest(this.dropdown).length==0){if(d(f.target).closest("option").length==0){this.isDocumentMouseDown=false;this.hideDropdown()}}return false};c.prototype.updateDropdownPosition=function(){if(this.isSelectShow){if(this.settings.appendToBody){this.dropdown.css({position:"absolute",top:this.select.offset().top+this.select.outerHeight(true),left:this.select.offset().left,"z-index":"9999"})}else{this.dropdown.css({position:"absolute",top:this.select.position().top+this.select.outerHeight(true),left:this.select.position().left,"z-index":"9999"})}var g=this.select.outerWidth()-this.select.width();var f=this.dropdown.outerWidth()-this.dropdown.width();this.dropdown.width(this.select.outerWidth(true));if(this.dropdown.width()==this.select.outerWidth()){this.dropdown.width((this.select.width()+g)-f)}if(this.isJScrollPane){this.initJScrollPane()}}};c.prototype.setSelectValue=function(f){this.selectValue.text(f)};c.prototype.isOptionGroup=function(){return this.domSelect.find("optgroup").length>0};c.prototype.addOptionGroup=function(){var f=this.domSelect.find("optgroup");for(var h=0;h<f.length;h++){var g=this.domSelect.find("option").index(d(f[h]).find("option:first-child"));d(this.templates.dropdown.optionLabel).text(d(f[h]).attr("label")).insertBefore(this.dropdownItem.eq(g))}};c.prototype.addItems=function(f,g){var g=d(g);var h=d(this.templates.dropdown.item).text(g.text());if(g.attr("disabled")){h.addClass("disabled")}if(g.attr("selected")){this.domSelect.find("option").removeAttr("selected");h.addClass("selected");g.attr("selected","selected")}h.appendTo(this.dropdownList)};c.prototype.getSelectedItem=function(){return this.dropdown.find(".selected").eq(0)};c.prototype.update=function(){this.destroy();this.init()};c.prototype.destroy=function(){this.domSelect.unbind("focus",d.proxy(this,"onFocus"));this.domSelect.unbind("blur",d.proxy(this,"onBlur"));this.domSelect.unbind("change",d.proxy(this,"onChange"));this.select.unbind("click",d.proxy(this,"onSelectClick"));this.dropdownItem.unbind("click",d.proxy(this,"onDropdownItemClick"));this.select.remove();this.dropdown.remove();this.showDomSelect();this.settings.onDestroy&&this.settings.onDestroy.apply(this,[this.domSelect,"destroy"])};d.fn.coreUISelect=function(f,g){return this.each(function(){var h=d(this).data("coreUISelect");if(f=="destroy"&&!h){return}if(h){f=(typeof f=="string"&&h[f])?f:"update";h[f].apply(h);if(f=="destroy"){d(this).removeData("coreUISelect");for(var j=0;j<a.length;j++){if(a[j]==h){a.splice(j,1);break}}}}else{h=new c(d(this),f,g);a.push(h);d(this).data("coreUISelect",h)}})};function e(i,f,h){var h=h||document;if(i!==undefined||i!==null){if(h.createEvent){var g=h.createEvent("MouseEvents");g.initEvent(f,true,false);i.dispatchEvent(g)}else{if(h.createEventObject){var g=h.createEventObject();i.fireEvent("on"+f,g)}}}}d(document).bind("mousedown",function(g){for(var f=0;f<a.length;f++){a[f].onDocumentMouseDown(g)}});d(document).bind("keyup",function(g){for(var f=0;f<a.length;f++){if(d.browser.safari||d.browser.msie||d.browser.opera){a[f].changeDropdownData(g)}a[f].addListenerByServicesKey(g)}});d(document).bind(d.browser.safari?"keydown":"keypress",function(g){for(var f=0;f<a.length;f++){a[f].changeDropdownData(g)}});d(window).bind("resize",function(g){for(var f=0;f<a.length;f++){a[f].updateDropdownPosition(g)}})})(jQuery);